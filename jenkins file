pipeline {

	agent any

	options {
		buildDiscarder(logRotator(numToKeepStr: '3', artifactNumToKeepStr: '3'))
	}

	tools {
		maven 'mvn_3.9.9'
	}

	stages {
		stage('Code Compilation') {
			steps {
				echo 'Starting Code Compilation...'
				sh 'mvn clean compile'
				echo 'Code Compilation Completed Successfully!'
			}
		}
		stage('Code QA Execution') {
			steps {
				echo 'Running JUnit Test Cases...'
				sh 'mvn clean test'
				echo 'JUnit Test Cases Completed Successfully!'
			}
		}
		stage('SonarQube Code Quality') {
            environment {
                scannerHome = tool 'qube'
            }
            steps {
                echo 'Starting SonarQube Code Quality Scan...'
                withSonarQubeEnv('sonar-server') {
                    sh 'mvn sonar:sonar'
                }
                echo 'SonarQube Scan Completed. Checking Quality Gate...'
                timeout(time: 10, unit: 'MINUTES') {
                    waitForQualityGate abortPipeline: true
                }
                echo 'Quality Gate Check Completed!'
            }
        }
		stage('Code Package') {
			steps {
				echo 'Creating JAR Artifact...'
				sh 'mvn clean package'
				echo 'WAR Artifact Created Successfully!'
			}
